<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multi-stage designs • MAMS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Multi-stage designs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">MAMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../../articles/web_only/reproducibility.html">Reproducibility</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/parallelisation.html">Parallelisation</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Design studies</h6></li>
    <li><a class="dropdown-item" href="../../articles/web_only/single-stage_design.html">Single stage design</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/multi-stage_design.html">Multi-stage design</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/evaluating_properties.html">Design operating characteristics</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/step-down_design.html">A step-down design</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/unforeseen_design_modifications.html">Unforeseen design modifications</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/non-normal_endpoints.html">Non-normal endpoints</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multi-stage designs</h1>
            
      

      <div class="d-none name"><code>multi-stage_design.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<br><a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Here we further consider the TAILoR study as motivating example but
now with more than 1 stage (J&gt;1).  Since only a single stage was used
in this initial example, no form of the boundaries had to be specified.
For multi-stage designs the shape of the lower and upper boundary can be
defined via the arguments <code>lshape</code> and <code>ushape</code>.
These arguments can either invoke the pre-defined shapes following <span class="citation">(<a href="#ref-pocock1977">POCOCK 1977</a>)</span>,
<span class="citation">(<a href="#ref-obrien1979">O’Brien and Fleming
1979</a>)</span> or the triangular test <span class="citation">(<a href="#ref-whitehead1997">Whitehead 1997</a>)</span> using options
<code>"pocock"</code>, <code>"obf"</code>, or <code>"triangular"</code>,
respectively. Alternatively a constant value (option
<code>"fixed"</code>) can be specified. Finally, custom boundaries can
be defined as a function that requires exactly one argument for the
number of stages and returns a vector of the same length. The lower
boundary shape must be non-decreasing while the upper boundary shape
must be non-increasing to ensure reasonable trial designs are found.</p>
</div>
<div class="section level2">
<h2 id="triangular-boundaries">Triangular boundaries<a class="anchor" aria-label="anchor" href="#triangular-boundaries"></a>
</h2>
<p>In the following example we calculate a two-stage design
investigating three experimental treatments. Triangular boundaries are
used with a cumulative sample size ratio of <code>r=1:2</code> between
first and second stage, i.e., the interim analysis is scheduled after
half of the maximum number of patients have been recruited and their
outcome observed, and twice as many subjects on control as on the
experimental arms, as specified by <code>r0 = c(2, 4)</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/MAMS.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">2</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, r0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>           power <span class="op">=</span> <span class="fl">0.9</span>, ushape <span class="op">=</span> <span class="st">"triangular"</span>, lshape <span class="op">=</span> <span class="st">"triangular"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Design parameters for a 2 stage trial with 3 treatments:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                                             Stage 1 Stage 2</span></span>
<span><span class="co">## Cumulative sample size per stage (control):      76     152</span></span>
<span><span class="co">## Cumulative sample size per stage (active):       38      76</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Maximum total sample size:  380 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              Stage 1 Stage 2</span></span>
<span><span class="co">## Upper bound:   2.359   2.225</span></span>
<span><span class="co">## Lower bound:   0.786   2.225</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Simulated error rates based on 50000 simulations:</span></span>
<span><span class="co">##                                                           </span></span>
<span><span class="co">## Prop. rejecting at least 1 hypothesis:               0.948</span></span>
<span><span class="co">## Prop. rejecting first hypothesis (Z_1&gt;Z_2,...,Z_K)   0.904</span></span>
<span><span class="co">## Prop. rejecting hypothesis 1:                        0.926</span></span>
<span><span class="co">## Expected sample size:                              235.003</span></span></code></pre>
<p>The cumulative sample sizes at stages 1 and 2 are given in tabular
form in the R output. The trial may be stopped after the first analysis,
either for futility (if all the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
statistics are less than 0.786) or superiority (if at least one
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
statistic exceeds 2.359). In all other cases the trial is to be taken to
the second stage where additional patients are randomized to any
experimental treatment whose
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
statistic falls between the boundary values of the first stage and
control. A critical value of 2.225 is used at the second analysis to
decide whether a treatment shall be deemed superior to control or
not.</p>
</div>
<div class="section level2">
<h2 id="user-defined-function-boundaries">User defined function boundaries<a class="anchor" aria-label="anchor" href="#user-defined-function-boundaries"></a>
</h2>
<p>Our next example involves three treatment arms in a three-stage
design with equal numbers of subjects added at every stage as well as
balance of sample size between control and treatment groups; this
requires us to specify the cumulative sample sizes as <code>r=1:3</code>
and <code>r0=1:3</code>. To illustrate the versatility of the function
<code>mams,</code> we do not use any of the pre-defined boundary shapes.
Instead we implement a fixed lower bound of zero (with
<code>lshape = "fixed"</code> and <code>lfix = 0</code>) and an upper
boundary where the first-stage critical value is three times as large as
the final critical value. To achieve this, <code>ushape</code> is
specified as a function that returns the vector (3, 2, 1)
(<code>return(x:1)</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/MAMS.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, power <span class="op">=</span> <span class="fl">0.9</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, </span>
<span>           r0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, ushape <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, lshape <span class="op">=</span> <span class="st">"fixed"</span>, lfix <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Design parameters for a 3 stage trial with 3 treatments:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                                             Stage 1 Stage 2 Stage 3</span></span>
<span><span class="co">## Cumulative sample size per stage (control):      27      54      81</span></span>
<span><span class="co">## Cumulative sample size per stage (active):       27      54      81</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Maximum total sample size:  324 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              Stage 1 Stage 2 Stage 3</span></span>
<span><span class="co">## Upper bound:   6.124   4.083   2.041</span></span>
<span><span class="co">## Lower bound:   0.000   0.000   2.041</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Simulated error rates based on 50000 simulations:</span></span>
<span><span class="co">##                                                           </span></span>
<span><span class="co">## Prop. rejecting at least 1 hypothesis:               0.914</span></span>
<span><span class="co">## Prop. rejecting first hypothesis (Z_1&gt;Z_2,...,Z_K)   0.899</span></span>
<span><span class="co">## Prop. rejecting hypothesis 1:                        0.910</span></span>
<span><span class="co">## Expected sample size:                              279.932</span></span></code></pre>
<p>The maximum total sample size is considerably lower than with design
<code>m2</code> (324 versus 380), and so is the critical value at the
final stage (2.042 versus 2.225). These feigned advantages come,
however, at the cost of very large upper boundary values at stages 1 and
2 (6.125 and 4.084) that make it extremely hard to stop the trial early,
so this is unlikely to be a useful design in practice. On a related
note, if a design should not allow stopping for one of efficacy or
futility at all, we can achieve this by setting <code>lfix = -Inf</code>
or <code>ufix = Inf</code>, respectively.</p>
</div>
<div class="section level2">
<h2 id="compare-pocock-obrien-fleming-and-triangular-boundaries">Compare Pocock, O’Brien-Fleming and triangular boundaries<a class="anchor" aria-label="anchor" href="#compare-pocock-obrien-fleming-and-triangular-boundaries"></a>
</h2>
<p>We compare the boundaries of our “own” design <code>m3</code> with
those of the corresponding standard designs (Pocock, O’Brien-Fleming,
triangular) graphically using the plot function that comes with the
<strong>MAMS</strong> package. First we have to compute the boundaries
of the standard designs for <code>J = 3</code> stages and sample size
allocations as in <code>m3</code>. Notice that the computation of
designs with more than 2 stages can take several minutes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/MAMS.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, r0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>            power <span class="op">=</span> <span class="fl">0.9</span>, ushape <span class="op">=</span> <span class="st">"pocock"</span>, lshape <span class="op">=</span> <span class="st">"pocock"</span><span class="op">)</span></span>
<span><span class="va">obf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/MAMS.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, r0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>            power <span class="op">=</span> <span class="fl">0.9</span>, ushape <span class="op">=</span> <span class="st">"obf"</span>, lshape <span class="op">=</span> <span class="st">"obf"</span><span class="op">)</span></span>
<span><span class="va">tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/MAMS.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, r0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>            power <span class="op">=</span> <span class="fl">0.9</span>, ushape <span class="op">=</span> <span class="st">"triangular"</span>, lshape <span class="op">=</span> <span class="st">"triangular"</span><span class="op">)</span></span></code></pre></div>
<p>Then we plot the boundaries with identical scaling of the vertical
axes (using the argument <code>ylim</code>) to make the graphs visually
comparable:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">poc</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Pocock"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obf</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"O'Brien-Fleming"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tri</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Triangular"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m3</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Self-designed"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="multi-stage_plot.png" alt="Multi-stage design plot"><div class="figcaption">Multi-stage design plot</div>
</div>
<p>Figure displays the shapes of all four designs. We see that the
triangular design has clearly the narrowest boundaries (and therefore
the highest chances of stopping the trial early) whereas the
self-designed variant leads to extraordinarily high upper boundary
values at the first two interim analyses.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-obrien1979" class="csl-entry">
O’Brien, Peter C., and Thomas R. Fleming. 1979. <span>“A Multiple
Testing Procedure for Clinical Trials.”</span> <em>Biometrics</em> 35
(3): 549. <a href="https://doi.org/10.2307/2530245" class="external-link">https://doi.org/10.2307/2530245</a>.
</div>
<div id="ref-pocock1977" class="csl-entry">
POCOCK, S. J. 1977. <span>“Group Sequential Methods in the Design and
Analysis of Clinical Trials.”</span> <em>Biometrika</em> 64 (2): 191–99.
<a href="https://doi.org/10.1093/biomet/64.2.191" class="external-link">https://doi.org/10.1093/biomet/64.2.191</a>.
</div>
<div id="ref-whitehead1997" class="csl-entry">
Whitehead, J. 1997. <span>“The Design and Analysis of Sequential
Clinical Trials.”</span> <em>Biometrics</em> 53 (4): 1564. <a href="https://doi.org/10.2307/2533535" class="external-link">https://doi.org/10.2307/2533535</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Jaki, Dominique-Laurent Couturier, Dominic Magirr, Nikita Mozgunov, Philip Pallmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
