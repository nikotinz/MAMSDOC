<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MAMS">
<title>Multi-stage design • MAMS</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Multi-stage design">
<meta property="og:description" content="MAMS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">MAMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <h6 class="dropdown-header" data-toc-skip>Basics</h6>
    <a class="dropdown-item" href="../../articles/web_only/reproducibility.html">Reproducibility</a>
    <a class="dropdown-item" href="../../articles/web_only/parallelisation.html">Parallelisation</a>
    <h6 class="dropdown-header" data-toc-skip>Design studies</h6>
    <a class="dropdown-item" href="../../articles/ssd_webr/ssd_webr.html">Single stage design</a>
    <a class="dropdown-item" href="../../articles/web_only/multi-stage_design.html">Multi-stage design</a>
    <a class="dropdown-item" href="../../articles/web_only/evaluating_properties.html">Evaluating the properties of a design</a>
    <a class="dropdown-item" href="../../articles/web_only/step-down_design.html">A step-down design</a>
    <a class="dropdown-item" href="../../articles/web_only/unforeseen_design_modifications.html">Unforeseen design modifications</a>
    <a class="dropdown-item" href="../../articles/web_only/non-normal_endpoints.html">Non-normal endpoints</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Multi-stage design</h1>
            
      
      
      <div class="d-none name"><code>multi-stage_design.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Since only a single stage was used in this initial example, no form
of the boundaries had to be specified. For multi-stage designs the shape
of the lower and upper boundary can be defined via the arguments
<code>lshape</code> and <code>ushape</code>. These arguments can either
invoke the pre-defined shapes following <span class="citation">(<a href="#ref-pocock1977">POCOCK 1977</a>)</span>, <span class="citation">(<a href="#ref-obrien1979">O’Brien and Fleming
1979</a>)</span> or the triangular test <span class="citation">(<a href="#ref-whitehead1997">Whitehead 1997</a>)</span> using options
<code>"pocock"</code>, <code>"obf"</code>, or <code>"triangular"</code>,
respectively. Alternatively a constant value (option
<code>"fixed"</code>) can be specified. Finally, custom boundaries can
be defined as a function that requires exactly one argument for the
number of stages and returns a vector of the same length. The lower
boundary shape must be non-decreasing while the upper boundary shape
must be non-increasing to ensure reasonable trial designs are found.</p>
</div>
<div class="section level2">
<h2 id="multi-stage-designs-with-different-boundary-shapes">Multi-stage designs with different boundary shapes<a class="anchor" aria-label="anchor" href="#multi-stage-designs-with-different-boundary-shapes"></a>
</h2>
<p>In the following example we calculate a two-stage design
investigating three experimental treatments. Triangular boundaries are
used with a cumulative sample size ratio of <code>r=1:2</code> between
first and second stage, i.e., the interim analysis is scheduled after
half of the maximum number of patients have been recruited and their
outcome observed, and twice as many subjects on control as on the
experimental arms, as specified by <code>r0 = c(2, 4)</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mams.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">2</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, r0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>           power <span class="op">=</span> <span class="fl">0.9</span>, ushape <span class="op">=</span> <span class="st">"triangular"</span>, lshape <span class="op">=</span> <span class="st">"triangular"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span></span></code></pre></div>
<pre><code><span><span class="co">## Design parameters for a 2 stage trial with 3 treatments</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                                             Stage 1 Stage 2</span></span>
<span><span class="co">## Cumulative sample size per stage (control):      76     152</span></span>
<span><span class="co">## Cumulative sample size per stage (active):       38      76</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Maximum total sample size:  380 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              Stage 1 Stage 2</span></span>
<span><span class="co">## Upper bound:   2.359   2.225</span></span>
<span><span class="co">## Lower bound:   0.786   2.225</span></span></code></pre>
<p>The cumulative sample sizes at stages 1 and 2 are given in tabular
form in the R output. The trial may be stopped after the first analysis,
either for futility (if all the <span class="math inline">\(Z\)</span>
statistics are less than 0.786) or superiority (if at least one <span class="math inline">\(Z\)</span> statistic exceeds 2.359). In all other
cases the trial is to be taken to the second stage where additional
patients are randomized to any experimental treatment whose <span class="math inline">\(Z\)</span> statistic falls between the boundary
values of the first stage and control. A critical value of 2.225 is used
at the second analysis to decide whether a treatment shall be deemed
superior to control or not.</p>
<p>Our next example involves three treatment arms in a three-stage
design with equal numbers of subjects added at every stage as well as
balance of sample size between control and treatment groups; this
requires us to specify the cumulative sample sizes as <code>r=1:3</code>
and <code>r0=1:3</code>. To illustrate the versatility of the function
<code>mams,</code> we do not use any of the pre-defined boundary shapes.
Instead we implement a fixed lower bound of zero (with
<code>lshape = "fixed"</code> and <code>lfix = 0</code>) and an upper
boundary where the first-stage critical value is three times as large as
the final critical value. To achieve this, <code>ushape</code> is
specified as a function that returns the vector (3, 2, 1)
(<code>return(x:1)</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mams.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, power <span class="op">=</span> <span class="fl">0.9</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, </span>
<span>           r0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, ushape <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, lshape <span class="op">=</span> <span class="st">"fixed"</span>, lfix <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3</span></span></code></pre></div>
<pre><code><span><span class="co">## Design parameters for a 3 stage trial with 3 treatments</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                                             Stage 1 Stage 2 Stage 3</span></span>
<span><span class="co">## Cumulative sample size per stage (control):      27      54      81</span></span>
<span><span class="co">## Cumulative sample size per stage (active):       27      54      81</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Maximum total sample size:  324 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              Stage 1 Stage 2 Stage 3</span></span>
<span><span class="co">## Upper bound:   6.124   4.083   2.041</span></span>
<span><span class="co">## Lower bound:   0.000   0.000   2.041</span></span></code></pre>
<p>The maximum total sample size is considerably lower than with design
<code>m2</code> (324 versus 380), and so is the critical value at the
final stage (2.042 versus 2.225). These feigned advantages come,
however, at the cost of very large upper boundary values at stages 1 and
2 (6.125 and 4.084) that make it extremely hard to stop the trial early,
so this is unlikely to be a useful design in practice. On a related
note, if a design should not allow stopping for one of efficacy or
futility at all, we can achieve this by setting <code>lfix = -Inf</code>
or <code>ufix = Inf</code>, respectively. We compare the boundaries of
our “own” design <code>m3</code> with those of the corresponding
standard designs (Pocock, O’Brien-Fleming, triangular) graphically using
the plot function that comes with the <strong>MAMS</strong> package.
First we have to compute the boundaries of the standard designs for
<code>J = 3</code> stages and sample size allocations as in
<code>m3</code>. Notice that the computation of designs with more than 2
stages can take several minutes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mams.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, r0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>            power <span class="op">=</span> <span class="fl">0.9</span>, ushape <span class="op">=</span> <span class="st">"pocock"</span>, lshape <span class="op">=</span> <span class="st">"pocock"</span><span class="op">)</span></span>
<span><span class="va">obf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mams.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, r0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>            power <span class="op">=</span> <span class="fl">0.9</span>, ushape <span class="op">=</span> <span class="st">"obf"</span>, lshape <span class="op">=</span> <span class="st">"obf"</span><span class="op">)</span></span>
<span><span class="va">tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/mams.html">mams</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fl">0.65</span>, p0 <span class="op">=</span> <span class="fl">0.55</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, r0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>            power <span class="op">=</span> <span class="fl">0.9</span>, ushape <span class="op">=</span> <span class="st">"triangular"</span>, lshape <span class="op">=</span> <span class="st">"triangular"</span><span class="op">)</span></span></code></pre></div>
<p>Then we plot the boundaries with identical scaling of the vertical
axes (using the argument ylim) to make the graphs visually
comparable:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">poc</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Pocock"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obf</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"O'Brien-Fleming"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tri</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Triangular"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m3</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Self-designed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="multi-stage_plot.png"></p>
<p>Figure displays the shapes of all four designs. We see that the
triangular design has clearly the narrowest boundaries (and therefore
the highest chances of stopping the trial early) whereas the
self-designed variant leads to extraordinarily high upper boundary
values at the first two interim analyses.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-obrien1979" class="csl-entry">
O’Brien, Peter C., and Thomas R. Fleming. 1979. <span>“A Multiple
Testing Procedure for Clinical Trials.”</span> <em>Biometrics</em> 35
(3): 549. <a href="https://doi.org/10.2307/2530245" class="external-link">https://doi.org/10.2307/2530245</a>.
</div>
<div id="ref-pocock1977" class="csl-entry">
POCOCK, S. J. 1977. <span>“Group Sequential Methods in the Design and
Analysis of Clinical Trials.”</span> <em>Biometrika</em> 64 (2): 191–99.
<a href="https://doi.org/10.1093/biomet/64.2.191" class="external-link">https://doi.org/10.1093/biomet/64.2.191</a>.
</div>
<div id="ref-whitehead1997" class="csl-entry">
Whitehead, J. 1997. <span>“The Design and Analysis of Sequential
Clinical Trials.”</span> <em>Biometrics</em> 53 (4): 1564. <a href="https://doi.org/10.2307/2533535" class="external-link">https://doi.org/10.2307/2533535</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Thomas Jaki, Dominique-Laurent Couturier, Dominic Magirr, Philip Pallmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
