<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dealing with unforeseen design modifications • MAMS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Dealing with unforeseen design modifications">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">MAMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><h6 class="dropdown-header" data-toc-skip>Basics</h6></li>
    <li><a class="dropdown-item" href="../../articles/web_only/reproducibility.html">Reproducibility</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/parallelisation.html">Parallelisation</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Design studies</h6></li>
    <li><a class="dropdown-item" href="../../articles/web_only/single-stage_design.html">Single stage design</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/multi-stage_design.html">Multi-stage design</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/evaluating_properties.html">Design operating characteristics</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/step-down_design.html">A step-down design</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/unforeseen_design_modifications.html">Unforeseen design modifications</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/non-normal_endpoints.html">Non-normal endpoints</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Dealing with unforeseen design modifications</h1>
            
      

      <div class="d-none name"><code>unforeseen_design_modifications.Rmd</code></div>
    </div>

    
    
<p>Two functions of the package: <code>new.bounds</code> and
<code>stepdown.update</code>, allow for unexpected design modifications
to be taken into account. The function <code>new.bounds</code>
recalculates the boundary values when the sample sizes achieved are not
as planned in advance. We consider again the two-stage design
<code>m2</code> studied in the <a href="multi-stage_design.html">Multi-stage design section</a> where 76
patients were required per stage in the control arm and 38 patients per
stage for each of the three experimental treatment arms. Now assume
these requirements could not be met and the observed sample sizes at the
interim analysis were 75 for control and 40, 35, and 41 for the
experimental treatments. We can recalculate the final boundary value
with new.bounds in which we specify the interim bounds
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>=</mo><mn>2.359</mn></mrow><annotation encoding="application/x-tex">u = 2.359</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo>=</mo><mn>0.786</mn></mrow><annotation encoding="application/x-tex">l = 0.786</annotation></semantics></math>
(as obtained for <code>m2</code>). The sample sizes as observed at stage
1 and planned for stage 2 are given in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>×</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">J × (K + 1)</annotation></semantics></math>
matrix <code>nMat</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/new.bounds.html">new.bounds</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">2</span>,</span>
<span> nMat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">152</span>, <span class="fl">40</span>, <span class="fl">76</span>, <span class="fl">35</span>, <span class="fl">76</span>, <span class="fl">41</span>, <span class="fl">76</span><span class="op">)</span>,</span>
<span> nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, u <span class="op">=</span> <span class="va">m2</span><span class="op">$</span><span class="va">u</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, l <span class="op">=</span> <span class="va">m2</span><span class="op">$</span><span class="va">l</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span> ushape <span class="op">=</span> <span class="st">"triangular"</span>, lshape <span class="op">=</span> <span class="st">"triangular"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Design parameters for a 2 stage trial with 3 treatments:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              Stage 1 Stage 2</span></span>
<span><span class="co">## Upper bound:   2.359   2.224</span></span>
<span><span class="co">## Lower bound:   0.786   2.224</span></span></code></pre>
<p>We find that as a result of the deviation from the planned sample
size at the interim analysis, the final boundary value has been lowered
from 2.225 in the original <code>m2</code> design to 2.224. The function
<code>stepdown.update</code> uses the conditional error approach to
incorporate unplanned sample size reassessment and/or treatment
selection (e.g., elimination of treatment arms due to safety issues)
while maintaining control of the desired FWER. We once again base this
example on the original three-arm two-stage design but consider the
step-down version (<code>m2.all</code>) studied in the <a href="step-down_design.html">Step-down design section</a> and assume
there were some unforeseen design changes during the course of the
trial. Initially the sample sizes at interim were planned to be 76 for
the control group and 38 per active treatment arm. At the interim
analysis, we now wish to take into account three deviations from the
planned study.</p>
<p>Firstly, we want to account for the deviation from the desired sample
size which, as in the previous example, turned out to be 75 for control
and 40, 35, and 41 for the experimental treatments, which translates to
<code>nobs = c(75, 40, 35,41)</code> in the function
<code><a href="../../reference/stepdown.update.html">stepdown.update()</a></code>. Secondly, treatment 2 has been dropped
from the study due to safety, so that only treatment arms 1 and 3
(<code>selected.trts = c(1, 3)</code>) are to be continued.Finally,
following a reassessment of the sample size, we wish to increase the
cumulative sample size at the second stage by 50% from 152 to 228 in the
control arm and 76 to 114 in the active arms. We can specify this using
<code>nfuture = matrix(c(228,114, 35, 114), 1, 4)</code>.</p>
<p>Notice that since treatment arm 2 has already been abandoned, no
additional patients are recruited beyond the 35 already in the study.
Further supposing the interim evaluation yielded Z statistics of
<code>zscores = c(1.1, 0.9, 0.9)</code>, we can calculate the modified
design.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2.update</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/stepdown.update.html">stepdown.update</a></span><span class="op">(</span>current.mams <span class="op">=</span> <span class="va">m2.all</span>,</span>
<span>nobs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">40</span>, <span class="fl">35</span>, <span class="fl">41</span><span class="op">)</span>, zscores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">0.9</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>selected.trts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, nfuture <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">228</span>, <span class="fl">114</span>, <span class="fl">35</span>, <span class="fl">114</span><span class="op">)</span>,</span>
<span>nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We summarise in Table 3 (column “Updated”) the output of
<code>m2.update</code>. The boundaries for the elementary hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>1</mn></msub><annotation encoding="application/x-tex">H_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>3</mn></msub><annotation encoding="application/x-tex">H_3</annotation></semantics></math>
have been slightly increased to account for the change in sample size
while the boundary for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>2</mn></msub><annotation encoding="application/x-tex">H_2</annotation></semantics></math>
has been slightly decreased. Similarly, the boundary for the
intersection hypothesis involving only the remaining treatments
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>13</mn></msub><annotation encoding="application/x-tex">H_{13}</annotation></semantics></math>)
has been increased while the others have been decreased. No change in
the threshold for the global null hypothesis
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>123</mn></msub><annotation encoding="application/x-tex">H_{123}</annotation></semantics></math>)
is observed in this example. As before we can also illustrate the
updated design using the plot function.</p>
<table class="table">
<thead><tr class="header">
<th>Hypotheses</th>
<th align="center">Initial</th>
<th align="center">Updated (cond. error)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>1</mn></msub><annotation encoding="application/x-tex">H_1</annotation></semantics></math></td>
<td align="center">1.72</td>
<td align="center">1.73(0.088)</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>2</mn></msub><annotation encoding="application/x-tex">H_2</annotation></semantics></math></td>
<td align="center">1.72</td>
<td align="center">2.02(0.069)</td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>3</mn></msub><annotation encoding="application/x-tex">H_3</annotation></semantics></math></td>
<td align="center">1.72</td>
<td align="center">2.17(0.058)</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>12</mn></msub><annotation encoding="application/x-tex">H_{12}</annotation></semantics></math></td>
<td align="center">2.06</td>
<td align="center">1.71(0.056)</td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>13</mn></msub><annotation encoding="application/x-tex">H_{13}</annotation></semantics></math></td>
<td align="center">2.06</td>
<td align="center">2.02(0.051)</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>23</mn></msub><annotation encoding="application/x-tex">H_{23}</annotation></semantics></math></td>
<td align="center">2.06</td>
<td align="center">2.17(0.043)</td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>123</mn></msub><annotation encoding="application/x-tex">H_{123}</annotation></semantics></math></td>
<td align="center">2.22</td>
<td align="center">1.71(0.041)</td>
</tr>
</tbody>
</table>
<p>Initial and updated upper boundaries (with conditional errors) for
the elementary
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>1</mn></msub><annotation encoding="application/x-tex">H_1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>2</mn></msub><annotation encoding="application/x-tex">H_2</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>3</mn></msub><annotation encoding="application/x-tex">H_3</annotation></semantics></math>),
intersection
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>12</mn></msub><annotation encoding="application/x-tex">H_{12}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>13</mn></msub><annotation encoding="application/x-tex">H_{13}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>23</mn></msub><annotation encoding="application/x-tex">H_{23}</annotation></semantics></math>),
and global
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>123</mn></msub><annotation encoding="application/x-tex">H_{123}</annotation></semantics></math>)
hypotheses of a three-arm twostage step-down design involving selection
of all promising treatments at interim. Treatment 2 has been dropped at
the interim analysis and the sample size for the remaining comparisons
increased.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Jaki, Dominique-Laurent Couturier, Dominic Magirr, Nikita Mozgunov, Philip Pallmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
