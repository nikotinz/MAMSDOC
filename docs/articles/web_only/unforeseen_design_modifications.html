<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MAMS">
<title>Dealing with unforeseen design modifications • MAMS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Dealing with unforeseen design modifications">
<meta property="og:description" content="MAMS">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">MAMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <h6 class="dropdown-header" data-toc-skip>Basics</h6>
    <a class="dropdown-item" href="../../articles/web_only/reproducibility.html">Reproducibility</a>
    <a class="dropdown-item" href="../../articles/web_only/parallelisation.html">Parallelisation</a>
    <h6 class="dropdown-header" data-toc-skip>Design studies</h6>
    <a class="dropdown-item" href="../../articles/web_only/single-stage_design.html">Single stage design</a>
    <a class="dropdown-item" href="../../articles/web_only/multi-stage_design.html">Multi-stage design</a>
    <a class="dropdown-item" href="../../articles/web_only/evaluating_properties.html">Desing operating charachteristics</a>
    <a class="dropdown-item" href="../../articles/web_only/step-down_design.html">A step-down design</a>
    <a class="dropdown-item" href="../../articles/web_only/unforeseen_design_modifications.html">Unforeseen design modifications</a>
    <a class="dropdown-item" href="../../articles/web_only/non-normal_endpoints.html">Non-normal endpoints</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Dealing with unforeseen design modifications</h1>
            
      
      
      <div class="d-none name"><code>unforeseen_design_modifications.Rmd</code></div>
    </div>

    
    
<p>Two functions of the package: <code>new.bounds</code> and
<code>stepdown.update</code>, allow for unexpected design modifications
to be taken into account. The function <code>new.bounds</code>
recalculates the boundary values when the sample sizes achieved are not
as planned in advance. We consider again the two-stage design
<code>m2</code> studied in the <a href="multi-stage_design.html">Multi-stage design section</a> where 76
patients were required per stage in the control arm and 38 patients per
stage for each of the three experimental treatment arms. Now assume
these requirements could not be met and the observed sample sizes at the
interim analysis were 75 for control and 40, 35, and 41 for the
experimental treatments. We can recalculate the final boundary value
with new.bounds in which we specify the interim bounds <span class="math inline">\(u = 2.359\)</span> and <span class="math inline">\(l = 0.786\)</span> (as obtained for
<code>m2</code>). The sample sizes as observed at stage 1 and planned
for stage 2 are given in the <span class="math inline">\(J × (K +
1)\)</span> matrix <code>nMat</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/new.bounds.html">new.bounds</a></span><span class="op">(</span>K <span class="op">=</span> <span class="fl">3</span>, J <span class="op">=</span> <span class="fl">2</span>,</span>
<span> nMat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">152</span>, <span class="fl">40</span>, <span class="fl">76</span>, <span class="fl">35</span>, <span class="fl">76</span>, <span class="fl">41</span>, <span class="fl">76</span><span class="op">)</span>,</span>
<span> nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, u <span class="op">=</span> <span class="va">m2</span><span class="op">$</span><span class="va">u</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, l <span class="op">=</span> <span class="va">m2</span><span class="op">$</span><span class="va">l</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span> ushape <span class="op">=</span> <span class="st">"triangular"</span>, lshape <span class="op">=</span> <span class="st">"triangular"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m2.nb</span></span></code></pre></div>
<pre><code><span><span class="co">## Design parameters for a 2 stage trial with 3 treatments</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##              Stage 1 Stage 2</span></span>
<span><span class="co">## Upper bound:   2.359   2.224</span></span>
<span><span class="co">## Lower bound:   0.786   2.224</span></span></code></pre>
<p>We find that as a result of the deviation from the planned sample
size at the interim analysis, the final boundary value has been lowered
from 2.225 in the original <code>m2</code> design to 2.224. The function
<code>stepdown.update</code> uses the conditional error approach to
incorporate unplanned sample size reassessment and/or treatment
selection (e.g., elimination of treatment arms due to safety issues)
while maintaining control of the desired FWER. We once again base this
example on the original three-arm two-stage design but consider the
step-down version (<code>m2.all</code>) studied in the <a href="step-down_design.html">Step-down design section</a> and assume
there were some unforeseen design changes during the course of the
trial. Initially the sample sizes at interim were planned to be 76 for
the control group and 38 per active treatment arm. At the interim
analysis, we now wish to take into account three deviations from the
planned study.</p>
<p>Firstly, we want to account for the deviation from the desired sample
size which, as in the previous example, turned out to be 75 for control
and 40, 35, and 41 for the experimental treatments, which translates to
<code>nobs = c(75, 40, 35,41)</code> in the function
<code><a href="../../reference/stepdown.update.html">stepdown.update()</a></code>. Secondly, treatment 2 has been dropped
from the study due to safety, so that only treatment arms 1 and 3
(<code>selected.trts = c(1, 3)</code>) are to be continued.Finally,
following a reassessment of the sample size, we wish to increase the
cumulative sample size at the second stage by 50% from 152 to 228 in the
control arm and 76 to 114 in the active arms. We can specify this using
<code>nfuture = matrix(c(228,114, 35, 114), 1, 4)</code>.</p>
<p>Notice that since treatment arm 2 has already been abandoned, no
additional patients are recruited beyond the 35 already in the study.
Further supposing the interim evaluation yielded Z statistics of
<code>zscores = c(1.1, 0.9, 0.9)</code>, we can calculate the modified
design.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2.update</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/stepdown.update.html">stepdown.update</a></span><span class="op">(</span>current.mams <span class="op">=</span> <span class="va">m2.all</span>,</span>
<span>nobs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">40</span>, <span class="fl">35</span>, <span class="fl">41</span><span class="op">)</span>, zscores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">0.9</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>selected.trts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, nfuture <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">228</span>, <span class="fl">114</span>, <span class="fl">35</span>, <span class="fl">114</span><span class="op">)</span>,</span>
<span>nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We summarise in Table 3 (column “Updated”) the output of
<code>m2.update</code>. The boundaries for the elementary hypothesis
<span class="math inline">\(H_1\)</span> and <span class="math inline">\(H_3\)</span> have been slightly increased to
account for the change in sample size while the boundary for <span class="math inline">\(H_2\)</span> has been slightly decreased.
Similarly, the boundary for the intersection hypothesis involving only
the remaining treatments (<span class="math inline">\(H_{13}\)</span>)
has been increased while the others have been decreased. No change in
the threshold for the global null hypothesis (<span class="math inline">\(H_{123}\)</span>) is observed in this example. As
before we can also illustrate the updated design using the plot
function.</p>
<table class="table">
<thead><tr class="header">
<th>Hypotheses</th>
<th align="center">Initial</th>
<th align="center">Updated (cond. error)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(H_1\)</span></td>
<td align="center">1.72</td>
<td align="center">1.73(0.088)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(H_2\)</span></td>
<td align="center">1.72</td>
<td align="center">2.02(0.069)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(H_3\)</span></td>
<td align="center">1.72</td>
<td align="center">2.17(0.058)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(H_{12}\)</span></td>
<td align="center">2.06</td>
<td align="center">1.71(0.056)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(H_{13}\)</span></td>
<td align="center">2.06</td>
<td align="center">2.02(0.051)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(H_{23}\)</span></td>
<td align="center">2.06</td>
<td align="center">2.17(0.043)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(H_{123}\)</span></td>
<td align="center">2.22</td>
<td align="center">1.71(0.041)</td>
</tr>
</tbody>
</table>
<p>Initial and updated upper boundaries (with conditional errors) for
the elementary (<span class="math inline">\(H_1\)</span>, <span class="math inline">\(H_2\)</span>, <span class="math inline">\(H_3\)</span>), intersection (<span class="math inline">\(H_{12}\)</span>, <span class="math inline">\(H_{13}\)</span>, <span class="math inline">\(H_{23}\)</span>), and global (<span class="math inline">\(H_{123}\)</span>) hypotheses of a three-arm
twostage step-down design involving selection of all promising
treatments at interim. Treatment 2 has been dropped at the interim
analysis and the sample size for the remaining comparisons
increased.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Thomas Jaki, Dominique-Laurent Couturier, Dominic Magirr, Nikita Mozgunov, Philip Pallmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
